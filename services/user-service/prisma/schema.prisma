generator client {
  provider        = "prisma-client-js"
  output          = "../src/generated/prisma"

}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")

}

model User {
  id              String            @id @default(uuid()) @db.Uuid
  tenantId        String            @map("tenant_id") @db.Uuid
  email           String            @unique @db.VarChar(255)
  passwordHash    String?           @map("password_hash") @db.VarChar(255)
  name            String            @db.VarChar(100)
  displayName     String?           @map("display_name") @db.VarChar(50)
  avatarUrl       String?           @map("avatar_url") @db.VarChar(500)
  coverUrl        String?           @map("cover_url") @db.VarChar(500)
  bio             String?
  location        String?           @db.VarChar(100)
  website         String?           @db.VarChar(255)
  phone           String?           @db.VarChar(20)
  birthDate       DateTime?         @map("birth_date") @db.Date
  gender          Gender?
  role            UserRole          @default(user)
  status          UserStatus        @default(pending_verification)
  isVerified      Boolean           @default(false) @map("is_verified")
  isPublic        Boolean           @default(true) @map("is_public")
  socialLinks     Json?             @default("{}") @map("social_links")
  metadata        Json?             @default("{}")
  followersCount  Int               @default(0) @map("followers_count")
  followingCount  Int               @default(0) @map("following_count")
  lastActiveAt    DateTime?         @map("last_active_at")
  emailVerified   Boolean           @default(false) @map("email_verified")
  emailVerifiedAt DateTime?         @map("email_verified_at")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  deletedAt       DateTime?         @map("deleted_at")
  activityLogs    UserActivityLog[]
  addresses       UserAddress[]
  following       UserFollower[]    @relation("Follower")
  followers       UserFollower[]    @relation("Following")
  preferences     UserPreference[]

  @@index([tenantId])
  @@index([email])
  @@index([status])
  @@index([displayName])
  @@index([createdAt])
  @@map("users")

}

model UserPreference {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  category  String   @db.VarChar(50)
  key       String   @db.VarChar(100)
  value     Json
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category, key])
  @@index([userId])
  @@index([category])
  @@map("user_preferences")

}

model UserAddress {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  label       String   @db.VarChar(50)
  streetLine1 String   @map("street_line1") @db.VarChar(255)
  streetLine2 String?  @map("street_line2") @db.VarChar(255)
  city        String   @db.VarChar(100)
  state       String?  @db.VarChar(100)
  postalCode  String   @map("postal_code") @db.VarChar(20)
  country     String   @db.VarChar(2)
  isDefault   Boolean  @default(false) @map("is_default")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_addresses")

}

model UserActivityLog {
  id         String   @id @default(uuid()) @db.Uuid
  userId     String   @map("user_id") @db.Uuid
  action     String   @db.VarChar(50)
  entityType String?  @map("entity_type") @db.VarChar(50)
  entityId   String?  @map("entity_id") @db.Uuid
  oldValues  Json?    @map("old_values")
  newValues  Json?    @map("new_values")
  ipAddress  String?  @map("ip_address") @db.VarChar(45)
  userAgent  String?  @map("user_agent") @db.VarChar(500)
  deviceType String?  @map("device_type") @db.VarChar(50)
  deviceName String?  @map("device_name") @db.VarChar(100)
  createdAt  DateTime @default(now()) @map("created_at")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([action])
  @@index([entityType, entityId])
  @@map("user_activity_logs")

}

model UserFollower {
  id          String   @id @default(uuid()) @db.Uuid
  followerId  String   @map("follower_id") @db.Uuid
  followingId String   @map("following_id") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at")
  follower    User     @relation("Follower", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("user_followers")

}

enum UserRole {
  user
  admin
  moderator


}

enum UserStatus {
  active
  suspended
  pending_verification
  deleted


}

enum Gender {
  male
  female
  other
  prefer_not_to_say


}
